{% extends 'base.html' %}
{% load static %}

{% block extra_css %}
<link type="text/css" href="{% static 'analytics/css/analytics.css' %}" rel="stylesheet" />
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
{% endblock %}

{% block content %}
<div class="analytics-container" id="analytics-page">
    <h1>АНАЛИТИКА</h1>
    <p>Ключевой тренд на современном IT-рынке — трансформация профессий.
        Количество вакансий сокращается из-за автоматизации и передачи рутинных задач ИИ.
        Работодатели теперь ждут от начинающих специалистов не просто умения писать код,
        а способности решать комплексные задачи и быстро адаптироваться к новым технологиям.</p>
</div>

<script>
window.onload = function() {

    // 1. Топ технологий
    new Chart(document.getElementById('techChart'), {
        type: 'bar',
        data: {
            labels: {{ tech_labels|safe }},
            datasets: [{
                label: 'Частота упоминаний (%)',
                data: {{ tech_data|safe }},
                backgroundColor: '#3498db'
            }]
        },
        options: {
            responsive: true,
            scales: {
                y: { beginAtZero: true, max: 100 }
            }
        }
    });

    // 2. География вакансий
    new Chart(document.getElementById('geoChart'), {
        type: 'pie',
        data: {
            labels: {{ geo_labels|safe }},
            datasets: [{
                data: {{ geo_data|safe }},
                backgroundColor: ['#e74c3c', '#3498db', '#2ecc71', '#f39c12', '#9b59b6']
            }]
        }
    });

    // 3. Типы занятости
    new Chart(document.getElementById('employmentChart'), {
        type: 'doughnut',
        data: {
            labels: {{ employment_labels|safe }},
            datasets: [{
                data: {{ employment_data|safe }},
                backgroundColor: ['#3498db', '#e74c3c', '#2ecc71']
            }]
        }
    });

    // 4. Зарплатные вилки
    new Chart(document.getElementById('salaryChart'), {
        type: 'bar',
        data: {
            labels: {{ salary_labels|safe }},
            datasets: [
                {
                    label: 'Минимальная',
                    data: {{ salary_min|safe }},
                    backgroundColor: '#e74c3c'
                },
                {
                    label: 'Средняя',
                    data: {{ salary_avg|safe }},
                    backgroundColor: '#3498db'
                },
                {
                    label: 'Максимальная',
                    data: {{ salary_max|safe }},
                    backgroundColor: '#2ecc71'
                }
            ]
        },
        options: {
            scales: {
                y: { beginAtZero: true }
            }
        }
    });

    // 5. Вакансии по специализациям
    new Chart(document.getElementById('vacanciesChart'), {
        type: 'bar',
        data: {
            labels: {{ vacancies_labels|safe }},
            datasets: [{
                label: 'Количество вакансий',
                data: {{ vacancies_data|safe }},
                backgroundColor: '#f39c12'
            }]
        },
        options: {
            scales: {
                y: { beginAtZero: true }
            }
        }
    });

    // 6. Языки программирования
    new Chart(document.getElementById('languagesChart'), {
        type: 'bar',
        data: {
            labels: {{ languages_labels|safe }},
            datasets: [{
                label: 'Доля вакансий (%)',
                data: {{ languages_data|safe }},
                backgroundColor: '#9b59b6'
            }]
        }
    });

    // 7. Backend фреймворки
    new Chart(document.getElementById('backendChart'), {
        type: 'pie',
        data: {
            labels: {{ backend_labels|safe }},
            datasets: [{
                data: {{ backend_data|safe }},
                backgroundColor: ['#1abc9c', '#3498db', '#e74c3c', '#f39c12', '#34495e']
            }]
        }
    });

    // 8. Frontend фреймворки
    new Chart(document.getElementById('frontendChart'), {
        type: 'doughnut',
        data: {
            labels: {{ frontend_labels|safe }},
            datasets: [{
                data: {{ frontend_data|safe }},
                backgroundColor: ['#61DAFB', '#42B883', '#DD0031', '#FF3E00']
            }]
        }
    });

};
</script>
{% endblock %}